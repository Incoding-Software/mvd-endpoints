#import "IncodingHelper.h"

@implementation IncodingHelper

-(void)refreshSession
{
    NSURLSessionConfiguration *sessionConfig = [NSURLSessionConfiguration defaultSessionConfiguration];    
    sessionConfig.timeoutIntervalForRequest = 30.0;
    sessionConfig.timeoutIntervalForResource = 30.0;
    sessionConfig.HTTPMaximumConnectionsPerHost = 15;
    
    _session = [NSURLSession sessionWithConfiguration:sessionConfig delegate:self delegateQueue:nil];
}

-(void)execute:(NSString *) requestString type:(NSString *)type done:(IncodingDone)done
{  
  NSString *urlString = [NSString stringWithFormat:@"http://localhost:48801/Dispatcher/%@?%@",type,requestString];
  NSURL *url = [NSURL URLWithString:urlString];

  if(!_session)
 {
   [self refreshSession];
 }

 NSURLSessionDataTask *getTask = [_session dataTaskWithURL:url completionHandler:^(NSData *data, NSURLResponse *response, NSError *error) {
                                   NSError *jsonError;                                          
                                   NSDictionary *result = [NSJSONSerialization JSONObjectWithData:data options:NSJSONReadingAllowFragments error:&jsonError];
                                   done(result);     }];    
 [getTask resume];
}
@end